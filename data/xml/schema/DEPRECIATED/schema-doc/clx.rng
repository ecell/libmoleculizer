<?xml version='1.0' encoding='UTF-8'?>
<!--Schema for clx unit in cpt (analogue of plex unit in mzr.)-->
<grammar-doc xmlns='http://relaxng.org/ns/structure/1.0' xmlns:rng='http://relaxng.org/ns/structure/1.0'>
  <define name='plex'>
    <element name='plex'>
      <doc>Use a plex element to describe the combinatorial structure of a complex.  That is, you give the individual mols (proteins) making up the complex and tell how they are bound together at binding sites.</doc>
      <ref name='optional-user-doc'/>
      <oneOrMore>
        <element name='mol-instance'>
          <doc>A mol-instance is a mol (a simple protein) as it appears in a complex.  The reason for mol-instances is that the same mol can appear more than once in a complex.  This approach gives each mol in the complex its own local "instance name," so that the binding pattern is easy to give, regardless of multiple occurrences of the same protein in a complex.  (The instance-name approach is borrowed from digital electronics, where components, like AND gates, can appear many many times in a design.  Instance names let you say which AND gate you mean.)</doc>
          <attribute name='name'>
            <doc>All the mols in a plex must have different instance names.</doc>
          </attribute>
          <ref name='optional-user-doc'/>
          <element name='mol-ref'>
            <doc>Use this mol-ref to say which mol a mol-instance is an instance of.  For example, in a dimeric complex of two "A" mols, you would have two mol-instances, A-one and A-two, both of which give A in their mol-ref elements.</doc>
            <attribute name='name'>
              <doc>This must be the name of a mol.</doc>
            </attribute>
            <ref name='optional-user-doc'/>
          </element>
        </element>
      </oneOrMore>
      <zeroOrMore>
        <element name='binding'>
          <doc>Each binding element describes how two binding sites on proteins in a complex are bound together.  Note that the complex must form a single, connected  molecule, so that if the complex has more than one mol, some bindings are necessary to hold them together.</doc>
          <ref name='optional-user-doc'/>
          <ref name='binding-partner'/>
          <ref name='binding-partner'/>
        </element>
      </zeroOrMore>
    </element>
  </define>
  <define name='state-query'>
    <element name='instance-states'>
      <doc>This element is used to describe the states of the mols in a complex.  At this stage in Moleculizer's development, the only mols, called mod-mols, represent modifiable, simple proteins.  The state of a mod-mol is described by telling what modifications are present at which modification sites on the simple protein.</doc>
      <ref name='optional-user-doc'/>
      <zeroOrMore>
        <choice>
          <element name='mod-mol-instance-ref'>
            <doc>This element is used to point at a particular mod-mol instance, in order to describe its modification state.  The state is described in the body of this element by giving the (non-default) modifications of the mod-mol.</doc>
            <attribute name='name'>
              <doc>This should be the name of a mod-mol instance in the complex.</doc>
            </attribute>
            <ref name='optional-user-doc'/>
            <ref name='mod-map'/>
          </element>
        </choice>
      </zeroOrMore>
    </element>
  </define>
  <define name='plex-class'>
    <!--This is for specifying both-->
    <!--classes of plex species and-->
    <!--individual plex species.-->
    <!--For classes of plex species, instance-->
    <!--states are 'wildcarded.'-->
    <!--For individual species, instance-->
    <!--states are defaulted.-->
    <ref name='plex'/>
    <optional>
      <ref name='state-query'/>
    </optional>
  </define>
  <define name='structure-query'>
    <element name='unbound-sites'>
      <doc>Use this element to specify binding sites that must be unbound in order for the omniplex to be recognized in a species.</doc>
      <zeroOrMore>
        <element name='instance-ref'>
          <doc>Use this element to point out which site must be unbound and which mol it lies on.</doc>
          <attribute name='name'>
            <doc>This should be the instance name of the mol on which the empty site is found.</doc>
          </attribute>
          <ref name='optional-user-doc'/>
          <element name='site-ref'>
            <doc>The element specifies which site must be unbound.</doc>
            <attribute name='name'>
              <doc>Must be the name of a binding site on the instance mol where the empty binding site must occur.</doc>
            </attribute>
            <ref name='optional-user-doc'/>
          </element>
        </element>
      </zeroOrMore>
    </element>
  </define>
  <define name='omni-plex-class'>
    <ref name='plex'/>
    <optional>
      <ref name='state-query'/>
    </optional>
    <optional>
      <ref name='structure-query'/>
    </optional>
  </define>
  <define name='binding-partner'>
    <element name='mol-instance-ref'>
      <doc>Use a mol-instance-ref to point to a particular component protein (mol) in a complex using its instance name. In the context of a binding-partner specification, you will also need to point to a binding site on the mol.</doc>
      <attribute name='name'>
        <doc>Give the instance name of the binding partner that you wish to specify.</doc>
      </attribute>
      <ref name='optional-user-doc'/>
      <element name='binding-site-ref'>
        <doc>Here, you specify a particular binding site on one of the partners in a binding.  You use the name of the binding site that you gave in the specification of the mol (simple protein) where the binding site appears.</doc>
        <attribute name='name'>
          <doc>Use the name that you gave to the binding site in the specification of the mol where the binding site appears.</doc>
        </attribute>
        <ref name='optional-user-doc'/>
      </element>
    </element>
  </define>
  <define name='plex-model-content'>
    <element name='allosteric-plexes'>
      <doc>One of the things in a binding site's environment that can be used to affect its binding to other binding sites is the whole complex that contains the binding site.  In this element, you can specify alternative shapes that bindings sites in the complex assume because of the whole complex, so that their binding properties are changed.  A typical example is that some binding site is occluded because of the overall configuration of the complex.  This modification of binding site shapes is applied at the very end of process of determining  the shapes of the binding sites in a new complex, so that it can override effects of the state of the mol bearing the binding site and the effects of any distinguished subcomplexes ("omniplexes") containing the binding site.</doc>
      <zeroOrMore>
        <element name='allosteric-plex'>
          <doc>Here, you tell how a particular complex affects the shapes of its binding sites.</doc>
          <ref name='optional-user-doc'/>
          <ref name='plex-class'/>
          <element name='allosteric-sites'>
            <doc>Here, you can indicate how a complex (or subcomplex) iteself affects the binding of its binding sites to other molecules.  For example, the geometrical configuration of the mols in the complex may cause one of the complex's binding sites to be obstructed, so that it no longer binds as readily (or at all) to its usual binding partners.</doc>
            <zeroOrMore>
              <element name='mol-instance-ref'>
                <doc>Here, you point to the mol that bears the binding site whose shape is affected by the complex where it appears (or some sub-complex.)</doc>
                <attribute name='name'>
                  <doc>This must be the instance name of one of the mols in the complex or subcomplex.</doc>
                </attribute>
                <ref name='optional-user-doc'/>
                <element name='binding-site-ref'>
                  <doc>Here you give the name of the binding site whose shape is affected by the complex or subcomplex</doc>
                  <attribute name='name'>
                    <doc>This must be the name of one of the binding sites on the mol named in the enclosing mol-instance-ref element.</doc>
                  </attribute>
                  <ref name='optional-user-doc'/>
                  <element name='site-shape-ref'>
                    <doc>Here you give the name of the shape that the subcomplex (or complex as a whole) causes the binding site to have.  For example, if the complex causes this binding site to be obstructed, you might want to define a  shape for the binding site called, say, "obstructed-shape," and refer to that shape here.</doc>
                    <attribute name='name'>
                      <doc>This must be the name of a shape that was given in the binding site's definition.</doc>
                    </attribute>
                    <ref name='optional-user-doc'/>
                  </element>
                </element>
              </element>
            </zeroOrMore>
          </element>
        </element>
      </zeroOrMore>
    </element>
    <element name='allosteric-omnis'>
      <doc>Moleculizer maintains a list of distinguished subcomplexes identified by the user as being important; these distinguished subcomplexes are called "omniplexes" in Moleculizer's internal jargon.  The complexes containing a specified subcomplex may be needed for output (via an "omni-species-stream") or because the subcomplex confers some special chemical property.  Use the allosteric-omnis section to tell how a distinguished subcomplex affects the binding of sites it contains.  </doc>
      <zeroOrMore>
        <element name='allosteric-omni'>
          <doc>Here, you tell how a certain subcomplex affects the shapes of its binding sites.  These effects will take place in all complexes that contain the distinguished subcomplex.</doc>
          <ref name='optional-user-doc'/>
          <ref name='omni-plex-class'/>
          <element name='allosteric-sites'>
            <doc>Here, you can indicate how a complex (or subcomplex) iteself affects the binding of its binding sites to other molecules.  For example, the geometrical configuration of the mols in the complex may cause one of the complex's binding sites to be obstructed, so that it no longer binds as readily (or at all) to its usual binding partners.</doc>
            <zeroOrMore>
              <element name='mol-instance-ref'>
                <doc>Here, you point to the mol that bears the binding site whose shape is affected by the complex where it appears (or some sub-complex.)</doc>
                <attribute name='name'>
                  <doc>This must be the instance name of one of the mols in the complex or subcomplex.</doc>
                </attribute>
                <ref name='optional-user-doc'/>
                <element name='binding-site-ref'>
                  <doc>Here you give the name of the binding site whose shape is affected by the complex or subcomplex</doc>
                  <attribute name='name'>
                    <doc>This must be the name of one of the binding sites on the mol named in the enclosing mol-instance-ref element.</doc>
                  </attribute>
                  <ref name='optional-user-doc'/>
                  <element name='site-shape-ref'>
                    <doc>Here you give the name of the shape that the subcomplex (or complex as a whole) causes the binding site to have.  For example, if the complex causes this binding site to be obstructed, you might want to define a  shape for the binding site called, say, "obstructed-shape," and refer to that shape here.</doc>
                    <attribute name='name'>
                      <doc>This must be the name of a shape that was given in the binding site's definition.</doc>
                    </attribute>
                    <ref name='optional-user-doc'/>
                  </element>
                </element>
              </element>
            </zeroOrMore>
          </element>
        </element>
      </zeroOrMore>
    </element>
  </define>
  <define combine='choice' name='explicit-species-content'>
    <element name='plex-species'>
      <doc>Use this element to specify a particular species of complex.  You might want to do this in order to give an initial population for the species, so that these complexes will be present when the simulation starts.  You can also explicitly create members of the species in the course of simulation.  Another reason to point out a particular species of complex is to get a running dump of the species's population, using a species-stream.  (But note that the majority of species of complexes are automatically created by Moleculizer as products of reactions; there is no need to specify all the species you expect to see in a Moleculizer simulation.)</doc>
      <attribute name='name'>
        <doc>All explicit-species must have different names.</doc>
      </attribute>
      <ref name='optional-user-doc'/>
      <ref name='plex-class'/>
      <element name='default-compartment-pop'>
        <doc>Give the population of the plex species that you wish to be present in most compartments at the beginning of the simulation.  You can override this population for any compartments you like using compartment-pop elements.  (You can use a create-event to add more of this species to any or all compartments at particular times in the course of simulation.)</doc>
        <attribute name='count'>
          <doc>This should be a non-negative integer.</doc>
        </attribute>
        <ref name='optional-user-doc'/>
      </element>
      <zeroOrMore>
        <element name='compartment-pop'>
          <doc>Use as many of these OPTIONAL elements to override the default population for any or all compartments.</doc>
          <attribute name='compartment-name'>
            <doc>Give the name of the compartment in which to override the default population.</doc>
          </attribute>
          <attribute name='count'>
            <doc>Give the population with which you wish to override the default population in this compartment.  This population should be a non-negative integer.</doc>
          </attribute>
          <ref name='optional-user-doc'/>
        </element>
      </zeroOrMore>
    </element>
  </define>
  <define combine='choice' name='tagged-species-content'>
    <element name='tagged-plex-species'>
      <doc>Same as an explicit plex species, except a tag (hex address) is given instead of a name.  Also, the population of the species at the time the state was dumped is given.</doc>
      <attribute name='tag'/>
      <attribute name='name'/>
      <ref name='plex-class'/>
      <element name='population'>
        <attribute name='count'/>
      </element>
      <element name='concentration'>
        <attribute name='value'/>
      </element>
    </element>
  </define>
  <define combine='choice' name='species-streams-content'>
    <choice>
      <element name='plex-species-stream'>
        <doc>A plex-species-stream allows you to see the total population of the species of complexes that have a particular structure.  At the same time, you can also restrict the output to species whose mols are in states that you specify.</doc>
        <attribute name='name'>
          <doc>The names of all species streams must be distinct.  The name of the species stream appears as a column-header in the dump file and as the name of the trace in a typical plot.</doc>
        </attribute>
        <ref name='optional-user-doc'/>
        <ref name='plex-class'/>
      </element>
      <element name='omni-species-stream'>
        <doc>An omni-species-stream allows you to see the total population of the species of complexes that contain a given subcomplex.  At the same time, you can also restrict the output to species in which the mols in your given subcomplex are in states that you specify.  An important special case of this construct is where the subcomplex is a "singleton" complex consisting of just one mol.  If the mol were a well-known protein, say Ste11, then the population dumped by this species stream would be "total Ste11," that is, all the species of complexes containing Ste11.  In this case, as with more elaborate subcomplexes, you could restrict the phosphorylation state of Ste11 to be the active state, in which case the reported population would be "total active Ste11."</doc>
        <attribute name='name'>
          <doc>The names of all species streams must be distinct.  The name of the species stream appears as a column-header in the dump file and as the name of the trace in a typical plot.</doc>
        </attribute>
        <ref name='optional-user-doc'/>
        <ref name='omni-plex-class'/>
      </element>
    </choice>
  </define>
</grammar-doc>

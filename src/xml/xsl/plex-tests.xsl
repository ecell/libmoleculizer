<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"><xsl:template name="test-mol-instance-name"><xsl:param name="the-plex-element"/><xsl:param name="the-instance-name"/><xsl:if test="not($the-plex-element/mol-instance[@name = $the-instance-name])"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>   There is no mol-instance named `  </xsl:text><xsl:value-of select="$the-instance-name"/><xsl:text>'.    </xsl:text></xsl:element></xsl:if></xsl:template><xsl:template name="test-mol-instance-name-unique"><xsl:param name="the-plex-element"/><xsl:param name="the-instance-name"/><xsl:if test="count($the-plex-element/mol-instance[@name = $the-instance-name]) &gt; 1"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>   Duplicate instance name `  </xsl:text><xsl:value-of select="$the-instance-name"/><xsl:text>'.    </xsl:text></xsl:element></xsl:if></xsl:template><xsl:template name="test-mol-instance-site-name"><xsl:param name="the-plex-element"/><xsl:param name="the-instance-name"/><xsl:param name="the-site-name"/><xsl:variable name="the-mol-instance-element" select="$the-plex-element/mol-instance[@name = $the-instance-name]"/><xsl:variable name="instance-mol-name" select="$the-mol-instance-element/mol-ref/@name"/><xsl:call-template name="test-mol-site-name"><xsl:with-param name="the-mol-name" select="$instance-mol-name"/><xsl:with-param name="the-site-name" select="$the-site-name"/></xsl:call-template></xsl:template><xsl:template name="test-mol-instance-mod-site-name"><xsl:param name="the-plex-element"/><xsl:param name="the-instance-name"/><xsl:param name="the-mod-site-name"/><xsl:variable name="the-mol-instance-element" select="$the-plex-element/mol-instance[@name = $the-instance-name]"/><xsl:variable name="instance-mol-name" select="$the-mol-instance-element/mol-ref/@name"/><xsl:call-template name="test-mol-mod-site-name"><xsl:with-param name="the-mol-name" select="$instance-mol-name"/><xsl:with-param name="the-mod-site-name" select="$the-mod-site-name"/></xsl:call-template></xsl:template><xsl:template name="test-mol-instance-site-shape-name"><xsl:param name="the-plex-element"/><xsl:param name="the-instance-name"/><xsl:param name="the-site-name"/><xsl:param name="the-shape-name"/><xsl:variable name="the-mol-instance-element" select="$the-plex-element/mol-instance[@name = $the-instance-name]"/><xsl:variable name="instance-mol-name" select="$the-mol-instance-element/mol-ref/@name"/><xsl:call-template name="test-site-shape-name"><xsl:with-param name="the-mol-name" select="$instance-mol-name"/><xsl:with-param name="the-site-name" select="$the-site-name"/><xsl:with-param name="the-shape-name" select="$the-shape-name"/></xsl:call-template></xsl:template><xsl:template match="mol-instance" mode="consistency"><xsl:call-template name="test-mol-instance-name-unique"><xsl:with-param name="the-plex-element" select=".."/><xsl:with-param name="the-instance-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="mol-instance/mol-ref" mode="consistency"><xsl:call-template name="test-mol-name"><xsl:with-param name="the-mol-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="binding/mol-instance-ref" mode="consistency"><xsl:call-template name="test-mol-instance-name"><xsl:with-param name="the-plex-element" select="../.."/><xsl:with-param name="the-instance-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="binding/mol-instance-ref/binding-site-ref" mode="consistency"><xsl:call-template name="test-mol-instance-site-name"><xsl:with-param name="the-plex-element" select="../../.."/><xsl:with-param name="the-instance-name" select="../@name"/><xsl:with-param name="the-site-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="allosteric-sites/mol-instance-ref" mode="consistency"><xsl:call-template name="test-mol-instance-name"><xsl:with-param name="the-plex-element" select="../preceding-sibling::plex[1]"/><xsl:with-param name="the-instance-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="allosteric-sites/mol-instance-ref/binding-site-ref" mode="consistency"><xsl:call-template name="test-mol-instance-site-name"><xsl:with-param name="the-plex-element" select="../../preceding-sibling::plex[1]"/><xsl:with-param name="the-instance-name" select="../@name"/><xsl:with-param name="the-site-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="allosteric-sites/mol-instance-ref/binding-site-ref/site-shape-ref" mode="consistency"><xsl:call-template name="test-mol-instance-site-shape-name"><xsl:with-param name="the-plex-element" select="../../../preceding-sibling::plex[1]"/><xsl:with-param name="the-instance-name" select="../../@name"/><xsl:with-param name="the-site-name" select="../@name"/><xsl:with-param name="the-shape-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="plex-species-stream" mode="consistency"><xsl:call-template name="test-species-stream-name-unique"><xsl:with-param name="the-species-stream-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="omni-species-stream" mode="consistency"><xsl:call-template name="test-species-stream-name-unique"><xsl:with-param name="the-species-stream-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="plex-species" mode="consistency"><xsl:call-template name="test-species-name-unique"><xsl:with-param name="the-species-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="instance-states/mod-mol-instance-ref" mode="consistency"><xsl:call-template name="test-mol-instance-name"><xsl:with-param name="the-plex-element" select="../preceding-sibling::plex[1]"/><xsl:with-param name="the-instance-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="instance-states/mod-mol-instance-ref/mod-map/mod-site-ref" mode="consistency"><xsl:call-template name="test-mol-instance-mod-site-name"><xsl:with-param name="the-plex-element" select="../../../preceding-sibling::plex[1]"/><xsl:with-param name="the-instance-name" select="../../@name"/><xsl:with-param name="the-mod-site-name" select="@name"/></xsl:call-template></xsl:template></xsl:stylesheet>
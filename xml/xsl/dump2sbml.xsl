<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:mathml="http://www.w3.org/1998/Math/MathML" xmlns:sbml="http://www.sbml.org/sbml/level2" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"><xsl:template match="moleculizer-state"><xsl:element name="sbml:sbml"><xsl:attribute name="level">2</xsl:attribute><xsl:attribute name="version">1</xsl:attribute><xsl:element name="sbml:model"><xsl:element name="sbml:listOfCompartments"><xsl:element name="sbml:compartment"><xsl:attribute name="id">theOnlyCompartment</xsl:attribute><xsl:attribute name="spatialDimensions">3</xsl:attribute><xsl:attribute name="size"><xsl:value-of select="model/volume/@liters"/></xsl:attribute><xsl:attribute name="units">liters</xsl:attribute></xsl:element></xsl:element><xsl:element name="sbml:listOfSpecies"><xsl:apply-templates select="model/tagged-species/*"/></xsl:element><xsl:element name="sbml:listOfReactions"><xsl:apply-templates select="model/tag-reactions/*"><xsl:with-param name="vol-fraction"><xsl:value-of select="volume/sci-note/@fraction"/></xsl:with-param><xsl:with-param name="vol-exponent"><xsl:value-of select="volume/sci-note/@exponent"/></xsl:with-param></xsl:apply-templates></xsl:element></xsl:element></xsl:element></xsl:template><xsl:template match="tagged-plex-species"><xsl:element name="sbml:species"><xsl:attribute name="id"><xsl:value-of select="concat('species', @tag)"/></xsl:attribute><xsl:attribute name="name"><xsl:value-of select="@name"/></xsl:attribute><xsl:attribute name="compartment">theOnlyCompartment</xsl:attribute><xsl:attribute name="initialAmount"><xsl:value-of select="population/@count"/></xsl:attribute><xsl:attribute name="substanceUnits">item</xsl:attribute><xsl:attribute name="hasOnlySubstanceUnits">true</xsl:attribute></xsl:element></xsl:template><xsl:template match="tagged-stoch-species"><xsl:element name="sbml:species"><xsl:attribute name="id"><xsl:value-of select="concat('species', @tag)"/></xsl:attribute><xsl:attribute name="name"><xsl:value-of select="@name"/></xsl:attribute><xsl:attribute name="compartment">theOnlyCompartment</xsl:attribute><xsl:attribute name="initialAmount"><xsl:value-of select="population/@count"/></xsl:attribute><xsl:attribute name="substanceUnits">item</xsl:attribute><xsl:attribute name="hasOnlySubstanceUnits">true</xsl:attribute></xsl:element></xsl:template><xsl:template match="tag-reaction"><xsl:param name="vol-fraction"/><xsl:param name="vol-exponent"/><xsl:element name="sbml:reaction"><xsl:attribute name="id"><xsl:value-of select="generate-id()"/></xsl:attribute><xsl:element name="sbml:listOfReactants"><xsl:apply-templates select="tagged-substrate"/></xsl:element><xsl:element name="sbml:listOfProducts"><xsl:apply-templates select="tagged-product"/></xsl:element><xsl:element name="sbml:kineticLaw"><xsl:element name="math" xmlns="http://www.w3.org/1998/Math/MathML"><xsl:element name="mathml:apply"><xsl:element name="mathml:times"/><xsl:element name="mathml:cn"><xsl:attribute name="type">e-notation</xsl:attribute><xsl:value-of select="rate/sci-note/@fraction"/><xsl:element name="sep"/><xsl:value-of select="rate/sci-note/@exponent"/></xsl:element><xsl:element name="mathml:cn"><xsl:attribute name="type">e-notation</xsl:attribute><xsl:value-of select="$vol-fraction"/><xsl:element name="sep"/><xsl:value-of select="$vol-exponent"/></xsl:element><xsl:apply-templates mode="making-rate-formula" select="tagged-substrate"/></xsl:element></xsl:element></xsl:element></xsl:element></xsl:template><xsl:template match="tagged-substrate"><xsl:element name="sbml:speciesReference"><xsl:attribute name="species"><xsl:value-of select="concat('species', @tag)"/></xsl:attribute><xsl:attribute name="stoichiometry"><xsl:value-of select="@multiplicity"/></xsl:attribute></xsl:element></xsl:template><xsl:template match="tagged-substrate" mode="making-rate-formula"><xsl:element name="mathml:ci"><xsl:value-of select="concat('species', @tag)"/></xsl:element></xsl:template><xsl:template match="tagged-product"><xsl:element name="sbml:speciesReference"><xsl:attribute name="species"><xsl:value-of select="concat('species', @tag)"/></xsl:attribute><xsl:attribute name="stoichiometry"><xsl:value-of select="@multiplicity"/></xsl:attribute></xsl:element></xsl:template></xsl:stylesheet>
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"><xsl:key match="mols/*" name="mol-name-key" use="@name"/><xsl:key match="modifications/*" name="mod-name-key" use="@name"/><xsl:template name="test-mol-name"><xsl:param name="the-mol-name"/><xsl:if test="not(key('mol-name-key', $the-mol-name))"><xsl:element name="p"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>   Unknown mol `</xsl:text><xsl:value-of select="$the-mol-name"/><xsl:text>'.</xsl:text></xsl:element></xsl:element></xsl:if></xsl:template><xsl:template name="test-mol-name-unique"><xsl:param name="the-mol-name"/><xsl:if test="count(key('mol-name-key', $the-mol-name)) &gt; 1"><xsl:element name="p"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>  Duplicate mol name `</xsl:text><xsl:value-of select="$the-mol-name"/><xsl:text>'.   </xsl:text></xsl:element></xsl:element></xsl:if></xsl:template><xsl:template name="test-mol-site-name"><xsl:param name="the-mol-name"/><xsl:param name="the-site-name"/><xsl:variable name="mol-element" select="key('mol-name-key', $the-mol-name)"/><xsl:if test="$mol-element"><!--This is a hack to prevent all the binding sites on small-mols--><!--from being flagged in HTML as bogus.  If a binding site name--><!--is the same as the name of its mol, then HTML syntax checking--><!--will assume that the mol is a small-mol and the binding site is valid.--><xsl:if test="not($mol-element/@name = $the-site-name)"><xsl:if test="not($mol-element/binding-site[@name = $the-site-name])"><xsl:element name="p"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>   No binding site `</xsl:text><xsl:value-of select="$the-site-name"/><xsl:text>'  on mol  </xsl:text><xsl:value-of select="$the-mol-name"/><xsl:text>.   </xsl:text></xsl:element></xsl:element></xsl:if></xsl:if></xsl:if></xsl:template><xsl:template name="test-mol-site-name-unique"><xsl:param name="the-mol-name"/><xsl:param name="the-site-name"/><xsl:variable name="mol-element" select="key('mol-name-key', $the-mol-name)"/><xsl:if test="count($mol-element) = 1"><xsl:if test="count($mol-element/binding-site[@name = $the-site-name]) &gt; 1"><xsl:element name="p"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>  Duplicate site name `</xsl:text><xsl:value-of select="$the-site-name"/><xsl:text>'  on mol  </xsl:text><xsl:value-of select="$the-mol-name"/><xsl:text>.   </xsl:text></xsl:element></xsl:element></xsl:if></xsl:if></xsl:template><xsl:template name="test-mol-mod-site-name"><xsl:param name="the-mol-name"/><xsl:param name="the-mod-site-name"/><xsl:variable name="mol-element" select="key('mol-name-key', $the-mol-name)"/><xsl:if test="$mol-element"><xsl:if test="not($mol-element/mod-site[@name = $the-mod-site-name])"><xsl:element name="p"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>   No modification site `</xsl:text><xsl:value-of select="$the-mod-site-name"/><xsl:text>'  on mol  </xsl:text><xsl:value-of select="$the-mol-name"/><xsl:text>.   </xsl:text></xsl:element></xsl:element></xsl:if></xsl:if></xsl:template><xsl:template name="test-mol-mod-site-name-unique"><xsl:param name="the-mol-name"/><xsl:param name="the-mod-site-name"/><xsl:variable name="mol-element" select="key('mol-name-key', $the-mol-name)"/><xsl:if test="count($mol-element) = 1"><xsl:if test="count($mol-element/mod-site[@name = $the-mod-site-name]) &gt; 1"><xsl:element name="p"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>   Duplicate modification site name `</xsl:text><xsl:value-of select="$the-mod-site-name"/><xsl:text>'  on mol  </xsl:text><xsl:value-of select="$the-mol-name"/><xsl:text>.   </xsl:text></xsl:element></xsl:element></xsl:if></xsl:if></xsl:template><xsl:template name="test-modification-name"><xsl:param name="the-mod-name"/><xsl:if test="not(key('mod-name-key', $the-mod-name))"><xsl:element name="p"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>   Unknown modification `</xsl:text><xsl:value-of select="$the-mod-name"/><xsl:text>'.</xsl:text></xsl:element></xsl:element></xsl:if></xsl:template><xsl:template name="test-modification-name-unique"><xsl:param name="the-mod-name"/><xsl:if test="count(key('mod-name-key', $the-mod-name)) &gt; 1"><xsl:element name="p"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>   Duplicate modification name `</xsl:text><xsl:value-of select="$the-mod-name"/><xsl:text>'.</xsl:text></xsl:element></xsl:element></xsl:if></xsl:template><xsl:template name="test-site-shape-name"><xsl:param name="the-mol-name"/><xsl:param name="the-site-name"/><xsl:param name="the-shape-name"/><xsl:variable name="mol-element" select="key('mol-name-key', $the-mol-name)"/><xsl:if test="$mol-element"><xsl:variable name="binding-site-element" select="$mol-element/binding-site[@name = $the-site-name]"/><xsl:if test="$binding-site-element"><xsl:if test="not($binding-site-element/site-shape[@name = $the-shape-name])"><xsl:element name="p"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>   Binding site </xsl:text><xsl:value-of select="$the-site-name"/><xsl:text>  on mol  </xsl:text><xsl:value-of select="$the-mol-name"/><xsl:text> has no shape named `</xsl:text><xsl:value-of select="$the-shape-name"/><xsl:text>'.</xsl:text></xsl:element></xsl:element></xsl:if></xsl:if></xsl:if></xsl:template><xsl:template name="test-site-shape-name-unique"><xsl:param name="the-mol-name"/><xsl:param name="the-site-name"/><xsl:param name="the-shape-name"/><xsl:variable name="mol-element" select="key('mol-name-key', $the-mol-name)"/><xsl:if test="count($mol-element) = 1"><xsl:variable name="binding-site-element" select="$mol-element/binding-site[@name = $the-site-name]"/><xsl:if test="count($binding-site-element) = 1"><xsl:if test="count($binding-site-element/site-shape[@name = $the-shape-name]) &gt; 1"><xsl:element name="p"><xsl:element name="font"><xsl:attribute name="color">red</xsl:attribute><xsl:text>   Duplicate shape name `</xsl:text><xsl:value-of select="$the-shape-name"/><xsl:text>'  on site  </xsl:text><xsl:value-of select="$the-site-name"/><xsl:text> of mol </xsl:text><xsl:value-of select="$the-mol-name"/><xsl:text>.</xsl:text></xsl:element></xsl:element></xsl:if></xsl:if></xsl:if></xsl:template><xsl:template match="modification" mode="consistency"><xsl:call-template name="test-modification-name-unique"><xsl:with-param name="the-mod-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="binding-site" mode="consistency"><xsl:call-template name="test-mol-site-name-unique"><xsl:with-param name="the-mol-name" select="../@name"/><xsl:with-param name="the-site-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="mod-mol" mode="consistency"><xsl:call-template name="test-mol-name-unique"><xsl:with-param name="the-mol-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="site-shape" mode="consistency"><xsl:call-template name="test-site-shape-name-unique"><xsl:with-param name="the-mol-name" select="../../@name"/><xsl:with-param name="the-site-name" select="../@name"/><xsl:with-param name="the-shape-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="default-shape-ref" mode="consistency"><xsl:call-template name="test-site-shape-name"><xsl:with-param name="the-mol-name" select="../../@name"/><xsl:with-param name="the-site-name" select="../@name"/><xsl:with-param name="the-shape-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="mod-site" mode="consistency"><xsl:call-template name="test-mol-mod-site-name-unique"><xsl:with-param name="the-mol-name" select="../@name"/><xsl:with-param name="the-mod-site-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="mod-site/default-mod-ref" mode="consistency"><xsl:call-template name="test-modification-name"><xsl:with-param name="the-mod-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="instance-states/mod-map/mod-site-ref" mode="consistency"><xsl:call-template name="test-mol-instance-mod-site-name"><xsl:with-param name="the-plex-element" select="../../../plex"/><xsl:with-param name="the-instance-name" select="../../mol-instance-ref/@name"/><xsl:with-param name="the-mod-site-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="allosteric-state/mod-map/mod-site-ref" mode="consistency"><xsl:call-template name="test-mol-mod-site-name"><xsl:with-param name="the-mol-name" select="../../../@name"/><xsl:with-param name="the-mod-site-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="site-shape-map/binding-site-ref" mode="consistency"><xsl:call-template name="test-mol-site-name"><xsl:with-param name="the-mol-name" select="../../../@name"/><xsl:with-param name="the-site-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="site-shape-map/binding-site-ref/site-shape-ref" mode="consistency"><xsl:call-template name="test-mol-site-name"><xsl:with-param name="the-mol-name" select="../../../@name"/><xsl:with-param name="the-site-name" select="@name"/></xsl:call-template><xsl:call-template name="test-site-shape-name"><xsl:with-param name="the-mol-name" select="../../../../@name"/><xsl:with-param name="the-site-name" select="../@name"/><xsl:with-param name="the-shape-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="mod-ref" mode="consistency"><xsl:call-template name="test-modification-name"><xsl:with-param name="the-mod-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="mol-ref" mode="consistency"><xsl:call-template name="test-mol-name"><xsl:with-param name="the-mol-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="mol-ref/site-ref" mode="consistency"><xsl:call-template name="test-mol-site-name"><xsl:with-param name="the-mol-name" select="../@name"/><xsl:with-param name="the-site-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="mod-mol-ref" mode="consistency"><xsl:call-template name="test-mol-name"><xsl:with-param name="the-mol-name" select="@name"/></xsl:call-template></xsl:template><xsl:template match="mod-mol-ref/mod-site-ref" mode="consistency"><xsl:call-template name="test-mol-mod-site-name"><xsl:with-param name="the-mol-name" select="../@name"/><xsl:with-param name="the-mod-site-name" select="@name"/></xsl:call-template></xsl:template></xsl:stylesheet>